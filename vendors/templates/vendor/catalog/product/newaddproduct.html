{% extends 'vendor/vendor-base/vendorbase.html' %}
{% load crispy_forms_filters %}
{% load static %}
{% load widget_tweaks %}
{% block body %}
    <div class="page-body">

        <!-- Container-fluid starts-->
        <div class="container-fluid">
            <div class="page-header">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="page-header-left">
                            <h3>Create Coupon
                                <small>Multikart Admin panel</small>
                            </h3>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <ol class="breadcrumb pull-right">
                            <li class="breadcrumb-item"><a href="index.html"><i data-feather="home"></i></a></li>
                            <li class="breadcrumb-item">Coupons</li>
                            <li class="breadcrumb-item active">Create Coupon</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <!-- Container-fluid Ends-->

        <!-- Container-fluid starts-->
        <div class="container-fluid">
            <div class="card tab2-card">
                <div class="card-header">
                    <h5>Discount Coupon Detailss</h5>
                </div>
                <div class="card-body">
                    <form class="needs-validation"  enctype="multipart/form-data"
                          action="{% url 'vendors:ProductCreate' %}"
                          method="post">
                        {% csrf_token %}
                    <ul class="nav nav-tabs tab-coupon" id="myTab" role="tablist">
                        <li class="nav-item"><a class="nav-link active show" id="general-tab" data-bs-toggle="tab"
                                                href="#general" role="tab" aria-controls="general" aria-selected="true"
                                                data-original-title="" title="">General</a></li>
                        <li class="nav-item"><a class="nav-link" id="restriction-tabs" data-bs-toggle="tab"
                                                href="#restriction" role="tab" aria-controls="restriction"
                                                aria-selected="false" data-original-title="" title="">Restriction</a>
                        </li>
                        <li class="nav-item"><a class="nav-link" id="usage-tab" data-bs-toggle="tab" href="#usage"
                                                role="tab" aria-controls="usage" aria-selected="false"
                                                data-original-title="" title="">Usage</a></li>
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade active show" id="general" role="tabpanel"
                             aria-labelledby="general-tab">
                            <form class="needs-validation" novalidate="" method="post"
                            id="" enctype="multipart/form-data" action="{% url 'vendors:ProductCreate' %}">
                                {% csrf_token %}
                                <h4>General</h4>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group row">
                                            <label for="validationCustom0" class="col-xl-3 col-md-4"><span>*</span>
                                                Coupan Title</label>
                                            <div class="col-md-7">
                                                <input class="form-control" id="validationCustom0" type="text"
                                                       required="">
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="validationCustom1" class="col-xl-3 col-md-4"><span>*</span>Coupan
                                                Code</label>
                                            <div class="col-md-7">
                                                <input class="form-control" id="validationCustom1" type="text"
                                                       required="">
                                            </div>
                                            <div class="valid-feedback">Please Provide a Valid Coupon Code.</div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-xl-3 col-md-4">Start Date</label>
                                            <div class="col-md-7">
                                                <input class="datepicker-here form-control digits" type="text"
                                                       data-language="en">
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-xl-3 col-md-4">End Date</label>
                                            <div class="col-md-7">
                                                <input class="datepicker-here form-control digits" type="text"
                                                       data-language="en">
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-xl-3 col-md-4">Free Shipping</label>
                                            <div class="col-md-7">
                                                <div class="checkbox checkbox-primary">
                                                    <input id="checkbox-primary-1" type="checkbox"
                                                           data-original-title="" title="">
                                                    <label for="checkbox-primary-1">Allow Free Shipping</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-xl-3 col-md-4">Quantity</label>
                                            <div class="col-md-7">
                                                <input class="form-control" type="number" required="">
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-xl-3 col-md-4">Discount Type</label>
                                            <div class="col-md-7">
                                                <select class="custom-select w-100 form-control" required="">
                                                    <option value="">--Select--</option>
                                                    <option value="1">Percent</option>
                                                    <option value="2">Fixed</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-xl-3 col-md-4">Status</label>
                                            <div class="col-md-7">
                                                <div class="checkbox checkbox-primary">
                                                    <input id="checkbox-primary-2" type="checkbox"
                                                           data-original-title="" title="">
                                                    <label for="checkbox-primary-2">Enable the Coupon</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="restriction" role="tabpanel" aria-labelledby="restriction-tabs">
                            <form class="needs-validation" novalidate="">
                                <h4>Restriction</h4>
                                <div class="form-group row">
                                    <label for="validationCustom3" class="col-xl-3 col-md-4">Products</label>
                                    <div class="col-md-7">
                                        <input class="form-control" id="validationCustom3" type="text" required="">
                                    </div>
                                    <div class="valid-feedback">Please Provide a Product Name.</div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-xl-3 col-md-4">Category</label>
                                    <div class="col-md-7">
                                        <select class="custom-select w-100 form-control" required="">
                                            <option value="">--Select--</option>
                                            <option value="1">Electronics</option>
                                            <option value="2">Clothes</option>
                                            <option value="2">Shoes</option>
                                            <option value="2">Digital</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="validationCustom4" class="col-xl-3 col-md-4">Minimum Spend</label>
                                    <div class="col-md-7">
                                        <input class="form-control" id="validationCustom4" type="number">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="validationCustom5" class="col-xl-3 col-md-4">Maximum Spend</label>
                                    <div class="col-md-7">
                                        <input class="form-control" id="validationCustom5" type="number">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="usage" role="tabpanel" aria-labelledby="usage-tab">
                            <form class="needs-validation" novalidate="">
                                <h4>Usage Limits</h4>
                                <div class="form-group row">
                                    <label for="validationCustom6" class="col-xl-3 col-md-4">Per Limit</label>
                                    <div class="col-md-7">
                                        <input class="form-control" id="validationCustom6" type="number">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="validationCustom7" class="col-xl-3 col-md-4">Per Customer</label>
                                    <div class="col-md-7">
                                        <input class="form-control" id="validationCustom7" type="number">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="pull-right">
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- Container-fluid Ends-->

    </div>


{% endblock %}


{% block custom_js %}
    <script src="//cdn.tiny.cloud/1/u6oa5pnpaa1vxho1md7uk4zmq2ai7xuf5o5wfgyrc131vpj6/tinymce/5/tinymce.min.js"
            referrerpolicy="origin"></script>
    <script>
        tinymce.init({
            selector: "textarea#long_desc",
            height: 300,
            plugins: [
                "advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker",
                "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking",
                "save table contextmenu directionality emoticons template paste textcolor",
            ],
            images_upload_url: "{% url 'core:file_upload' %}",
            toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | print preview media fullpage | forecolor backcolor emoticons",
            style_formats: [
                {title: "Bold text", inline: "b"},
                {title: "Red text", inline: "span", styles: {color: "#ff0000"}},
                {title: "Red header", block: "h1", styles: {color: "#ff0000"}},
                {title: "Example 1", inline: "span", classes: "example1"},
                {title: "Example 2", inline: "span", classes: "example2"},
                {title: "Table styles"},
                {title: "Table row 1", selector: "tr", classes: "tablerow1"},
            ],
            automatic_uploads: true,
            file_picker_types: 'image',
            file_picker_callback: function (cb, value, meta) {
                var input = document.createElement('input');
                input.setAttribute('type', 'file');
                input.setAttribute('accept', 'image/*');

                /*
                Note: In modern browsers input[type="file"] is functional without
                even adding it to the DOM, but that might not be the case in some older
                or quirky browsers like IE, so you might want to add it to the DOM
                just in case, and visually hide it. And do not forget do remove it
                once you do not need it anymore.
                */

                input.onchange = function () {
                    var file = this.files[0];

                    var reader = new FileReader();
                    reader.onload = function () {
                        /*
                        Note: Now we need to register the blob in TinyMCEs image blob
                        registry. In the next release this part hopefully won't be
                        necessary, as we are looking to handle it internally.
                        */
                        var id = 'blobid' + (new Date()).getTime();
                        var blobCache = tinymce.activeEditor.editorUpload.blobCache;
                        var base64 = reader.result.split(',')[1];
                        var blobInfo = blobCache.create(id, file, base64);
                        blobCache.add(blobInfo);

                        /* call the callback and populate the Title field with the file name */
                        cb(blobInfo.blobUri(), {title: file.name});
                    };
                    reader.readAsDataURL(file);
                };

                input.click();
            },
        });
    </script>
    <script>
        $(".add_media").click(function () {
            var media_row = $(".first_media").clone();
            media_row.removeClass("first_media");
            media_row.replaceAll("src", "")
            media_row.find(".select_media").val("");
            media_row.find(".img_preview").attr("src", "").css({"border": "none"}).css({"border-radius": "0px"}).hide();
            media_row.find(".video_preview").attr("src", "").css({"border": "none"}).css({"border-radius": "0px"}).hide();
            $(".media_div").append(media_row);
        });
        $(".remove_media").click(function () {
            if ($(".media_div").find(".media_div_row").length > 1) {
                $(".media_div").children().last().remove();
            }
        });

        $(".add_details").click(function () {
            var details_row = $(".first_details").clone();
            details_row.removeClass("first_details");
            details_row.find(".title_title").val("");
            details_row.find(".title_details").val("");
            $(".details_div").append(details_row);
        });
        $(".remove_details").click(function () {
            if ($(".details_div").find(".details_div_row").length > 1) {
                $(".details_div").children().last().remove();
            }
        });

        $(".add_about").click(function () {
            var about_row = $(".first_about").clone();
            about_row.removeClass("first_about");
            about_row.find(".about_title").val("");
            $(".about_div").append(about_row);
        });
        $(".remove_about").click(function () {
            if ($(".about_div").find(".about_div_row").length > 1) {
                $(".about_div").children().last().remove();
            }
        });

        $(document).on("change", ".select_media", function () {
            var media_type = $(this).parents(".media_div_row").find(".media_type").val();
            var img_preview = $(this).parents(".media_div_row").find(".img_preview");
            var vid_preview = $(this).parents(".media_div_row").find(".video_preview");
            showPreviewMedia(this, media_type, img_preview, vid_preview);
        });

        function showPreviewMedia(input, media_type, img_preview, video_preview) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    if (media_type == "1") {
                        img_preview.attr("src", e.target.result);
                        img_preview.show();
                        img_preview.css({"border": "5px solid orange"});
                        img_preview.css({"border-radius": "10px"});
                    }
                    if (media_type == "2") {
                        video_preview.show();
                        video_preview.css({"border": "5px solid orange"});
                        video_preview.css({"border-radius": "10px"});
                        video_preview.attr("src", e.target.result);
                        video_preview.load();
                        video_preview.play();

                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }


        $(".submit_btn").click(function () {
            var form = new FormData($("#myform")[0]);
            form.append("long_desc", tinyMCE.activeEditor.getContent());

            //AJAX CODE
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.status == 200) {
                    console.log(xhr.responseText);
                }
            }
            xhr.open("POST", "{% url 'vendors:ProductCreate' %}", true);
            $("#progressbar").show();

            //UPDATING PROGRESS BAR
            xhr.upload.addEventListener("progress", function (ev) {
                if (ev.lengthComputable) {
                    var percentage = (ev.loaded / ev.total * 100 | 0);
                    $("#progressbar").css({"width": "" + percentage + "%"}).text("Uploading .." + percentage + "%");
                    console.log(percentage);
                }
            });

            xhr.send(form);
        })

    </script>
    <script src="//bootstrap-tagsinput.github.io/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js"></script>
{% endblock custom_js %}





